<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correlation Matrix Explorer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .matrix-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .matrix-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            font-family: 'Courier New', Monaco, 'Lucida Console', monospace;
        }

        .matrix {
            display: inline-block;
            font-family: 'Courier New', monospace;
        }

        .matrix-row {
            display: flex;
        }

        .matrix-cell {
            width: 50px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: white;
            transition: background-color 0.2s;
            font-weight: 500;
        }

        .matrix-cell.clickable:hover {
            background-color: #e3f2fd;
            cursor: pointer;
        }

        .matrix-cell.row-header {
            background-color: #2196f3;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .matrix-cell.col-header {
            background-color: #4caf50;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background-color: #1976d2;
        }

        .info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }

        .color-legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 15px;
            border: 1px solid #ccc;
        }

        .matrix-cell.highlight-row {
            box-shadow: inset 0 0 0 3px rgba(33, 150, 243, 0.6);
            transform: scale(1.05);
        }

        .matrix-cell.highlight-col {
            box-shadow: inset 0 0 0 3px rgba(76, 175, 80, 0.6);
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <div class="info">
        <h2>Correlation Matrix Explorer</h2>
        <p><strong>Instructions:</strong> Click on row headers (blue) to randomize entire rows, or column headers
            (green) to randomize entire columns of matrix X. Watch how this affects the correlation structures in XX'
            and X'X!</p>
        <div class="color-legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #1a237e;"></div>
                <span>Strong Negative</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ffffff;"></div>
                <span>Neutral</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #b71c1c;"></div>
                <span>Strong Positive</span>
            </div>
        </div>
    </div>

    <div class="controls">
        <button onclick="generateNewMatrix()">Generate New Matrix</button>
    </div>

    <div class="container">
        <div class="matrix-container">
            <div class="matrix-title">XX<sup>T</sup> (Row Correlation)</div>
            <div id="xxTranspose" class="matrix"></div>
        </div>

        <div class="matrix-container">
            <div class="matrix-title">X</div>
            <div id="xMatrix" class="matrix"></div>
        </div>

        <div class="matrix-container">
            <div class="matrix-title">X<sup>T</sup>X (Column Correlation)</div>
            <div id="xTransposeX" class="matrix"></div>
        </div>
    </div>

    <script>
        let X = [];
        const rows = 5;
        const cols = 4;

        function generateRandomMatrix() {
            X = [];
            for (let i = 0; i < rows; i++) {
                X[i] = [];
                for (let j = 0; j < cols; j++) {
                    X[i][j] = (Math.random() - 0.5) * 4; // Random values between -2 and 2
                }
            }
        }

        function matrixMultiply(A, B) {
            const result = [];
            for (let i = 0; i < A.length; i++) {
                result[i] = [];
                for (let j = 0; j < B[0].length; j++) {
                    result[i][j] = 0;
                    for (let k = 0; k < B.length; k++) {
                        result[i][j] += A[i][k] * B[k][j];
                    }
                }
            }
            return result;
        }

        function transpose(matrix) {
            const result = [];
            for (let j = 0; j < matrix[0].length; j++) {
                result[j] = [];
                for (let i = 0; i < matrix.length; i++) {
                    result[j][i] = matrix[i][j];
                }
            }
            return result;
        }

        function getColorForValue(value, minVal = -10, maxVal = 10) {
            // Clamp value to the preset range
            const clampedValue = Math.max(minVal, Math.min(maxVal, value));

            // Normalize value to [-1, 1] range
            const normalizedValue = (clampedValue - minVal) / (maxVal - minVal) * 2 - 1;

            let r, g, b;

            if (normalizedValue < 0) {
                // Blue scale for negative values
                const intensity = Math.abs(normalizedValue);
                r = Math.round(255 * (1 - intensity * 0.9)); // Fade to darker blue
                g = Math.round(255 * (1 - intensity * 0.8));
                b = 255;
            } else {
                // Red scale for positive values
                const intensity = normalizedValue;
                r = 255;
                g = Math.round(255 * (1 - intensity * 0.8));
                b = Math.round(255 * (1 - intensity * 0.9)); // Fade to darker red
            }

            return `rgb(${r}, ${g}, ${b})`;
        }

        function getTextColorForBackground(bgColor) {
            // Extract RGB values from rgb() string
            const match = bgColor.match(/rgb\((\d+), (\d+), (\d+)\)/);
            if (!match) return '#000';

            const [, r, g, b] = match.map(Number);

            // Calculate perceived brightness
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;

            // Return dark text for light backgrounds, light text for dark backgrounds
            return brightness > 128 ? '#000' : '#fff';
        }

        function getMatrixValueRange(matrix) {
            let min = Infinity;
            let max = -Infinity;

            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[i].length; j++) {
                    min = Math.min(min, matrix[i][j]);
                    max = Math.max(max, matrix[i][j]);
                }
            }

            return { min, max };
        }

        function renderMatrix(matrix, containerId, isDataMatrix = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            for (let i = 0; i < matrix.length; i++) {
                const row = document.createElement('div');
                row.className = 'matrix-row';

                if (isDataMatrix) {
                    // Add row header for data matrix
                    const rowHeader = document.createElement('div');
                    rowHeader.className = 'matrix-cell row-header';
                    rowHeader.textContent = `R${i + 1}`;
                    rowHeader.onclick = () => randomizeRow(i);
                    rowHeader.onmouseenter = () => highlightRow(i);
                    rowHeader.onmouseleave = () => clearHighlights();
                    row.appendChild(rowHeader);
                }

                for (let j = 0; j < matrix[i].length; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    cell.textContent = matrix[i][j].toFixed(2);

                    // Apply color coding
                    const backgroundColor = getColorForValue(matrix[i][j]);
                    const textColor = getTextColorForBackground(backgroundColor);
                    cell.style.backgroundColor = backgroundColor;
                    cell.style.color = textColor;

                    if (isDataMatrix && i === 0) {
                        // Add column headers for first row of data matrix
                        const colHeader = document.createElement('div');
                        colHeader.className = 'matrix-cell col-header';
                        colHeader.textContent = `C${j + 1}`;
                        colHeader.onclick = () => randomizeColumn(j);
                        colHeader.onmouseenter = () => highlightColumn(j);
                        colHeader.onmouseleave = () => clearHighlights();

                        const headerRow = container.querySelector('.matrix-row') || document.createElement('div');
                        if (!container.querySelector('.matrix-row')) {
                            headerRow.className = 'matrix-row';
                            const emptyCorner = document.createElement('div');
                            emptyCorner.className = 'matrix-cell';
                            emptyCorner.style.backgroundColor = '#666';
                            headerRow.appendChild(emptyCorner);
                            container.appendChild(headerRow);
                        }
                        headerRow.appendChild(colHeader);
                    }

                    row.appendChild(cell);
                }

                container.appendChild(row);
            }
        }

        function randomizeRow(rowIndex) {
            for (let j = 0; j < cols; j++) {
                X[rowIndex][j] = (Math.random() - 0.5) * 4;
            }
            updateMatrices();
        }

        function randomizeColumn(colIndex) {
            for (let i = 0; i < rows; i++) {
                X[i][colIndex] = (Math.random() - 0.5) * 4;
            }
            updateMatrices();
        }

        function updateMatrices() {
            const XT = transpose(X);
            const XXT = matrixMultiply(X, XT);
            const XTX = matrixMultiply(XT, X);

            renderMatrix(XXT, 'xxTranspose');
            renderMatrix(X, 'xMatrix', true);
            renderMatrix(XTX, 'xTransposeX');
        }

        function highlightRow(rowIndex) {
            // Clear all highlights first
            clearHighlights();

            // Highlight the specific row in the data matrix
            const xMatrix = document.getElementById('xMatrix');
            const rows = xMatrix.querySelectorAll('.matrix-row');

            if (rows[rowIndex + 1]) { // +1 because first row is headers
                const cells = rows[rowIndex + 1].querySelectorAll('.matrix-cell');
                cells.forEach(cell => {
                    if (!cell.classList.contains('row-header')) {
                        cell.classList.add('highlight-row');
                    }
                });
            }

            // Highlight affected row and column in XX' (sample correlation matrix)
            const xxTranspose = document.getElementById('xxTranspose');
            const xxRows = xxTranspose.querySelectorAll('.matrix-row');

            // Highlight the entire row
            if (xxRows[rowIndex]) {
                const rowCells = xxRows[rowIndex].querySelectorAll('.matrix-cell');
                rowCells.forEach(cell => cell.classList.add('highlight-row'));
            }

            // Highlight the entire column (since XX' is symmetric)
            xxRows.forEach((row, i) => {
                const cells = row.querySelectorAll('.matrix-cell');
                if (cells[rowIndex]) {
                    cells[rowIndex].classList.add('highlight-row');
                }
            });
        }

        function highlightColumn(colIndex) {
            // Clear all highlights first
            clearHighlights();

            // Highlight the specific column in the data matrix
            const xMatrix = document.getElementById('xMatrix');
            const rows = xMatrix.querySelectorAll('.matrix-row');

            rows.forEach((row, rowIdx) => {
                const cells = row.querySelectorAll('.matrix-cell');
                // +1 to account for row header
                if (cells[colIndex + 1] && !cells[colIndex + 1].classList.contains('col-header')) {
                    cells[colIndex + 1].classList.add('highlight-col');
                }
            });

            // Highlight affected row and column in X'X (feature correlation matrix)
            const xTransposeX = document.getElementById('xTransposeX');
            const xtxRows = xTransposeX.querySelectorAll('.matrix-row');

            // Highlight the entire row
            if (xtxRows[colIndex]) {
                const rowCells = xtxRows[colIndex].querySelectorAll('.matrix-cell');
                rowCells.forEach(cell => cell.classList.add('highlight-col'));
            }

            // Highlight the entire column (since X'X is symmetric)
            xtxRows.forEach((row, i) => {
                const cells = row.querySelectorAll('.matrix-cell');
                if (cells[colIndex]) {
                    cells[colIndex].classList.add('highlight-col');
                }
            });
        }

        function clearHighlights() {
            const allCells = document.querySelectorAll('.matrix-cell');
            allCells.forEach(cell => {
                cell.classList.remove('highlight-row', 'highlight-col');
            });
        }

        function generateNewMatrix() {
            generateRandomMatrix();
            updateMatrices();
        }

        // Initialize
        generateRandomMatrix();
        updateMatrices();
    </script>
</body>

</html>